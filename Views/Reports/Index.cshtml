@model LawFirmManagement.Models.ReportViewModel

@{
    ViewData["Title"] = "Reports";
}

<!-- ================= DataTables CSS ================= -->
<link rel="stylesheet"
      href="https://cdn.datatables.net/2.3.6/css/dataTables.dataTables.min.css" />

<div class="container mt-4">

    <h2 class="mb-4">📊 Law Firm Reports</h2>

    <!-- ================= Filter Form ================= -->
    <form method="get" asp-action="Index" class="row g-3 mb-4">

        <div class="col-md-3">
            <label class="form-label">Report Type</label>
            <select name="reportType" class="form-select">
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly" selected>Monthly</option>
                <option value="Yearly">Yearly</option>
                <option value="Custom">Custom</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Start Date</label>
            <input type="date" name="startDate" class="form-control"
                   value="@Model.StartDate.ToString("yyyy-MM-dd")" />
        </div>

        <div class="col-md-3">
            <label class="form-label">End Date</label>
            <input type="date" name="endDate" class="form-control"
                   value="@Model.EndDate.ToString("yyyy-MM-dd")" />
        </div>

        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">
                Generate Report
            </button>
        </div>
    </form>

    <!-- ================= Download Button ================= -->
    <div class="mb-4 text-end">
        <a class="btn btn-success"
           asp-action="Download"
           asp-route-reportType="@Model.ReportType"
           asp-route-startDate="@Model.StartDate"
           asp-route-endDate="@Model.EndDate">
            ⬇ Download Report
        </a>
    </div>

    <!-- ================= Summary Cards ================= -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm p-3">
                <h6>Total Cases</h6>
                <h4>@Model.TotalCases</h4>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm p-3">
                <h6>Closed Cases</h6>
                <h4>@Model.ClosedCases</h4>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm p-3">
                <h6>Total Revenue</h6>
                <h4>@Model.TotalRevenue.ToString("N2") BDT</h4>
            </div>
        </div>
    </div>

    <!-- ================= Case Table ================= -->
    @if (Model.CaseList.Any())
    {
        <h4 class="mt-4">📁 Case History</h4>

        <table id="caseTable" class="display table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Case Title</th>
                    <th>Type</th>
                    <th>Start Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var c in Model.CaseList)
                {
                    <tr>
                        <td>@c.CaseTitle</td>
                        <td>@c.CaseType</td>
                        <td>@c.StartDate.ToString("dd-MMM-yyyy")</td>
                        <td>@c.Status</td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <!-- ================= Payment Table ================= -->
    @if (Model.PaymentList.Any())
    {
        <h4 class="mt-5">💰 Payment History</h4>

        <table id="paymentTable" class="display table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Case</th>
                    <th>Method</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var p in Model.PaymentList)
                {
                    <tr>
                        <td>@p.PaymentDate.ToString("dd-MMM-yyyy")</td>
                        <td>@p.Case?.CaseTitle</td>
                        <td>@p.PaymentMethod</td>
                        <td>@p.TotalAmount.ToString("N2")</td>
                    </tr>
                }
            </tbody>
        </table>
    }

</div>

<!-- ================= DataTables JS ================= -->
<script src="https://cdn.datatables.net/2.3.6/js/dataTables.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        if (document.getElementById('caseTable')) {
            new DataTable('#caseTable', {
                pageLength: 10,
                searching: true,
                ordering: true
            });
        }

        if (document.getElementById('paymentTable')) {
            new DataTable('#paymentTable', {
                pageLength: 10,
                searching: true,
                ordering: true
            });
        }
    });
</script>
